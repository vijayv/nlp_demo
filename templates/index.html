{% extends "base.html" %}
{% block content %}
  <div class="row">
    <div class="col-xs-6 col-lg-4">

      <div id="sidebar-button-container">
        <button id="plays" class="sidebar-param-button">plays</button>
        <button id="likes" class="sidebar-param-button">likes</button>
        <button id="reposts" class="sidebar-param-button">reposts</button>
        <button id="comments" class="sidebar-param-button">comments</button>
      </div>

    </div>
    <div id="content" class="col-xs-12 col-sm-6 col-lg-8">
    </div>
  </div>

  <script type="text/babel">

    var songs = [
      {artist: "Pete Hunt", song: "This is one comment", created_date: "12/1/2014"},
      {artist: "Jordan Walke", song: "This is *another* comment", created_date: "12/2/2014"},
      {artist: "LIka", song: "That comment", created_date: "12/3/2014"},
      {artist: "Miae", song: "This comment", created_date: "12/5/2014"},
    ];

    var SongList = React.createClass({
      getInitialState: function() {
        return {
          songList: [],
        }
      },

      componentDidMount: function() {
        $.ajax({
          url: "/api/v1/tracks?fields=track_user_name;track_title;track_genre;current_plays&limit=100&sort=current_plays",
          dataType: 'json',
          cache: false,
          success: function(data) {
            console.log(data);
            this.setState({songList: data});
          }.bind(this),
          error: function(xhr, status, err) {
            console.error("/api/v1/tracks", status, err.toString());
          }.bind(this)
        });
      },

      render: function() {
        var songNodes = this.state.songList.map(function(song) {
          console.log(song);
          return (
            <Song
              trackUsername={song.trackUsername}
              trackTitle={song.trackTitle}
              trackGenre={song.trackGenre}
              trackcurrentPlays={song.currentPlays} />
          )
        });

        return (
          <table className="table table-striped">
            <thead>
              <tr>
                <th>Artist Name</th>
                <th>Song Name</th>
                <th>Genre</th>
                <th>Play Count</th>
              </tr>
            </thead>
            <tbody>
              {songNodes}
            </tbody>
          </table>
        );
      }
    });

    var Song = React.createClass({
      render: function() {
        return (
          <tr>
            <td>{this.props.trackUsername}</td>
            <td>{this.props.trackTitle}</td>
            <td>{this.props.trackGenre}</td>
            <td>{this.props.trackcurrentPlays}</td>
          </tr>
        )
      }
    });

    ReactDOM.render(
      <SongList />,
      document.getElementById("content")
    );

    var LikesButton = React.createClass({
      getInitialState: function() {
        return {liked: false};
      },
      handleClick: function(event) {
        this.setState({liked: !this.state.liked});

        $.ajax({
            url: "/api/v1/tracks?fields=track_user_name;track_title;track_genre;current_likes&limit=100&sort=current_likes",
            dataType: 'json',
            cache: false,
            success: function(data) {
              console.log(data);
              this.setState({songList: data});
            }.bind(this),
            error: function(xhr, status, err) {
              console.error("/api/v1/tracks", status, err.toString());
            }.bind(this)
          });
        },

      render: function() {
        var text = this.state.liked ? 'like' : 'haven\'t liked';
        return (
          <span onClick={this.handleClick}>
            likes
          </span>
        );
      }
    });

    ReactDOM.render(
      <LikesButton />,
      document.getElementById('likes')
    );

  </script>
{% endblock %}
